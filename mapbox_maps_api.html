<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Map Box API</title>

    <!--Mapbox CDN-->
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.3.1/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.3.1/mapbox-gl.css' rel='stylesheet'/>
    <!-- Load the `mapbox-gl-geocoder` plugin. -->
    <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.7.2/mapbox-gl-geocoder.min.js"></script>
    <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.7.2/mapbox-gl-geocoder.css" type="text/css">
    <!--Bootstrap CDN-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css"
          integrity="sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn" crossorigin="anonymous">

    <style>
        body {
            margin: 0;
        }

        #map, #restaurantListDiv {
            /* the width and height may be set to any size */
            width: 48vw;
            height: 80vh;
        }

        ul {
            list-style-type: none;
        }
    </style>

</head>
<body class="bg-dark">
<div class="container-fluid">
    <div class="row">
        <div class="mt-3 ml-2" id='map'></div>
        <div id="restaurantListDiv" class="ml-4 mt-3">
            <h1 class="p-2 rounded bg-white text-center" id="page-title">My favorite restaurants</h1>
            <!--            List of favorite restaurants-->
            <table class="table bg-white table-striped rounded mt-3">
                <thead class="thead-light">
                <tr>
                    <th scope="col">#</th>
                    <th scope="col">Name</th>
                    <th scope="col">Address</th>
                    <th scope="col">Website</th>
                </tr>
                </thead>
                <tbody id="tableBody">

                </tbody>
            </table>

        </div>
    </div>
    <div class="row mt-3">
        <!--        Option to change zoom level with select input-->
        <label for="zoom" class="text-white px-3">Choose a zoom level:</label>

        <select class="rounded" name="zoom-levels" id="zoom">
            <option value="5">5</option>
            <option value="15" selected>15</option>
            <option value="20">20</option>
        </select>
        <button class="btn btn-light ml-5" id="re-center">Reset Map</button>
    </div>
</div>


<!--Bootstrap CDN-->
<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-fQybjgWLrvvRgtW6bFlB7jaZrFsaBXjsOMm/tB9LTS58ONXgqbR9W8oWht/amnpF"
        crossorigin="anonymous"></script>
<!--CDN Jquery File-->
<script src="https://code.jquery.com/jquery-2.2.4.min.js"
        integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
<script>

	(function () {
		//Mapbox map created
		mapboxgl.accessToken = 'pk.eyJ1IjoibHVjaWRhd2FyZW5lc3MiLCJhIjoiY2t6ZDc3aGVjMnY5YTJwbzJ1emdmNjEzbSJ9.-defpzf2vmE5LX-LBADjtQ';
		let map = new mapboxgl.Map({
			container: 'map',
			style: 'mapbox://styles/mapbox/streets-v11',
			zoom: 10,
			center: [
				-96.7969,
				32.7763
			]
		});

		// Add the control to the map.
		map.addControl(
			new MapboxGeocoder({
				accessToken: mapboxgl.accessToken,
				mapboxgl: mapboxgl
			})
		);


		//Array of objects containing details of favorite restaurants
		let restaurants = [{
			"name": "Sixty Vines",
			"address": "500 Crescent Ct Suite 160, Dallas, TX 75201",
			"website": " https://sixtyvines.com",
			"websiteShorthand": "sixtyvines.com",
			"position": [-96.80495, 32.79379]
		}, {
			"name": "Meso Maya",
			"address": "5280 Belt Line Rd, Addison, TX 75254",
			"website": "https://www.mesomaya.com",
			"websiteShorthand": "mesomaya.com",
			"position": [-96.81877, 32.95352]
		}, {
			"name": "Tortugas Mexican Kitchen",
			"address": "6010 Seawall Blvd, Galveston, TX 77551",
			"website": "https://tortugacantina.com",
			"websiteShorthand": "tortugacantina.com",
			"position": [-94.82559, 29.26749]
		}]
		// populates table with details of each restaurant
		restaurants.forEach(function (restaurant, index) {
			let restaurantNum = index + 1;
			$('#tableBody').append(`
                <tr>
                    <th scope="row">${restaurantNum}</th>
                    <td>${restaurant.name}</td>
                    <td>${restaurant.address}</td>
                    <td><a href="${restaurant.website}" target="_blank">${restaurant.websiteShorthand}</a></td>
                </tr>
			`);
			//Creates a marker for each restaurant/ part of forEach loop
			var marker = new mapboxgl.Marker()
				.setLngLat(restaurant.position)
				.addTo(map);
			//Creates a popup for each restaurant in array/ part of forEach loop
			var alamoPopup = new mapboxgl.Popup()
				.setHTML(`
                    <h3>${restaurant.name}</h3>
                    <p>Address: ${restaurant.address}</p>
                    <p>Web Site: <a href="${restaurant.website}" target="_blank">${restaurant.websiteShorthand}</a></p>

                        `);

			//Links the popup to a marker
			marker.setPopup(alamoPopup)
		});

		//Creates ability to change zoom level based on IF value of select input has changed
		$('select').change(function () {
			if ($(this).val() === 5) {
				map.setZoom($(this).val());
			} else if ($(this).val() === 10) {
				map.setZoom($(this).val());
			}
			map.setZoom($(this).val());
		})

		//Creates a fly to when a table row is clicked using the currently clicked restaurant position
		$('tr').each(function (index) {
			let indexNum = index - 1;
			$(this).click(function () {
				map.flyTo({
					center: restaurants[indexNum].position,
					zoom: 18,
					speed: 1.5,
					curve: 1,
					easing(t) {
						return t;
					}
				});

			})
		})

		//Creates ability to reset the map to the original load instance
		$('#re-center').click(function () {
			map.setZoom(10);
			map.setCenter([
				-96.7969,
				32.7763
			])
		})


	})();
</script>


</body>
</html>