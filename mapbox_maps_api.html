<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Map Box API</title>

    <!--Mapbox CDN-->
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.3.1/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.3.1/mapbox-gl.css' rel='stylesheet'/>
    <!-- Load the `mapbox-gl-geocoder` plugin. -->
    <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.7.2/mapbox-gl-geocoder.min.js"></script>
    <link rel="stylesheet"
          href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.7.2/mapbox-gl-geocoder.css"
          type="text/css">
    <!--Bootstrap CDN-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css"
          integrity="sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn" crossorigin="anonymous">

    <style>
        body {
            margin: 0;
        }

        #map, #restaurantListDiv {
            /* the width and height may be set to any size */
            width: 48vw;
            height: 80vh;
        }

        ul {
            list-style-type: none;
        }

        tr:hover {
            cursor: pointer;
        }

        .marker {
            display: block;
            border: 1px solid black;
            border-radius: 50%;
            cursor: pointer;
            padding: 0;
        }

        .mapboxgl-marker {
            -webkit-animation: glide 1s ease-in-out alternate 2s;
        }

        @-webkit-keyframes glide {
            from {
                left: 0px;
                top: 0px;
            }

            to {
                left: 0px;
                top: -10px;
            }

        }

    </style>

</head>
<body class="bg-dark">
<div class="container-fluid">
    <div class="row">
        <div class="mt-3 ml-2" id='map'></div>
        <div id="restaurantListDiv" class="ml-4 mt-3">
            <h1 class="p-2 rounded bg-white text-center" id="page-title">My favorite restaurants</h1>
            <p class="bg-warning text-center">FYI Click on table row to fly to that rows restaurant's location</p>
            <!--            List of favorite restaurants-->
            <table class="table bg-white table-striped rounded mt-3">
                <thead class="thead-light">
                <tr>
                    <th scope="col">#</th>
                    <th scope="col">Name</th>
                    <th scope="col">Address</th>
                    <th scope="col">Website</th>
                </tr>
                </thead>
                <tbody id="tableBody">

                </tbody>
            </table>

        </div>
    </div>
    <div class="row mt-3">
        <!--        Option to change zoom level with select input-->
        <label for="zoom" class="text-white px-3">Choose a zoom level:</label>

        <select class="rounded" name="zoom-levels" id="zoom">
            <option value="5">5</option>
            <option value="15" selected>15</option>
            <option value="20">20</option>
        </select>
        <button class="btn btn-light ml-4" id="re-center">Recenter Map</button>
        <button class="btn btn-light ml-4" id="hide-markers">Toggle Markers Display</button>
    </div>
</div>


<!--Bootstrap CDN-->
<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-fQybjgWLrvvRgtW6bFlB7jaZrFsaBXjsOMm/tB9LTS58ONXgqbR9W8oWht/amnpF"
        crossorigin="anonymous"></script>
<!--CDN Jquery File-->
<script src="https://code.jquery.com/jquery-2.2.4.min.js"
        integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
<script src="js/keys.js"></script>
<script>

	(function () {
		//Mapbox map created
		mapboxgl.accessToken = KEY_API_MAPBOX;
		let map = new mapboxgl.Map({
			container: 'map',
			style: 'mapbox://styles/mapbox/streets-v11',
			zoom: 10,
			center: [
				-96.7969,
				32.7763
			]
		});
        //Forward geopcoding set up
		function geocode(search, token) {
			var baseUrl = 'https://api.mapbox.com';
			var endPoint = '/geocoding/v5/mapbox.places/';
			return fetch(baseUrl + endPoint + encodeURIComponent(search) + '.json' + "?" + 'access_token=' + token)
				.then(function (res) {
					return res.json();
					// to get all the data from the request, comment out the following three lines...
				}).then(function (data) {
					return data.features[0].center;
				});
		}


		// Adds the search control to the map.
		map.addControl(
			new MapboxGeocoder({
				accessToken: mapboxgl.accessToken,
				mapboxgl: mapboxgl
			})
		);


		//Array of objects containing details of favorite restaurants
		let restaurants = [{
			"name": "Sixty Vines",
			"address": "500 Crescent Ct Suite 160, Dallas, TX 75201",
			"website": " https://sixtyvines.com",
			"websiteShorthand": "sixtyvines.com",
			"position": [-96.80495, 32.79379],
			"image_url": "url(https://sixtyvines.com/static/d50af3fac5380d4b1112fa7df3a0fef6/45cca/index-1.webp)"
		}, {
			"name": "Meso Maya",
			"address": "5280 Belt Line Rd, Addison, TX 75254",
			"website": "https://www.mesomaya.com",
			"websiteShorthand": "mesomaya.com",
			"position": [-96.81877, 32.95352],
			"image_url": "url(https://www.mesomaya.com/wp-content/uploads/2018/03/Downtown.jpg)"
		}, {
			"name": "Tortugas Mexican Kitchen",
			"address": "6010 Seawall Blvd, Galveston, TX 77551",
			"website": "https://tortugacantina.com",
			"websiteShorthand": "tortugacantina.com",
			"position": [-94.82559, 29.26749],
			"image_url": "url(https://tortugacantina.com/wp-content/uploads/2021/03/Tortuga_logo_notagline-1-230x116.png)"
		}]

		// the  geocode method from mapbox-geocoder-utils.js
		geocode(restaurants[0].position, mapboxgl.accessToken).then(function (result) {
			map.setCenter(result);
			map.setZoom(15);
		});

		// populates table with details of each restaurant
		restaurants.forEach(function (restaurant, index) {
			let restaurantNum = index + 1;
			$('#tableBody').append(`
                <tr>
                    <th scope="row">${restaurantNum}</th>
                    <td>${restaurant.name}</td>
                    <td>${restaurant.address}</td>
                    <td><a href="${restaurant.website}" target="_blank">${restaurant.websiteShorthand}</a></td>
                </tr>
			`);
			//Creates a marker for each restaurant/ part of forEach loop
			const el = document.createElement('div');
			const width = 75;
			const height = 75;
			el.className = `marker`;
			el.style.backgroundImage = restaurant.image_url;
			el.style.width = `${width}px`;
			el.style.height = `${height}px`;
			el.style.backgroundSize = '100%';

            // Add markers to the map.
			let marker = new mapboxgl.Marker(el)
				.setLngLat(restaurant.position)
				.addTo(map);
			//Creates a popup for each restaurant in array/ part of forEach loop
			let alamoPopup = new mapboxgl.Popup()
				.setHTML(`
                    <h3>${restaurant.name}</h3>
                    <p>Address: ${restaurant.address}</p>
                    <p>Web Site: <a href="${restaurant.website}" target="_blank">${restaurant.websiteShorthand}</a></p>

                        `);

			//Links the popup to a marker
			marker.setPopup(alamoPopup);

		});

		//Hides markers on button click
		$('#hide-markers').click(function () {
			$( ".marker" ).toggle();
		});


		//Creates ability to change zoom level based on IF value of select input has changed
		$('select').change(function () {
			if ($(this).val() === 5) {
				map.setZoom($(this).val());
			} else if ($(this).val() === 10) {
				map.setZoom($(this).val());
			}
			map.setZoom($(this).val());
		})

		//Creates a flyTo when a table row is clicked using the currently clicked restaurants physical position
		$('tr').each(function (index) {
			let indexNum = index - 1;
			$(this).click(function () {
				map.flyTo({
					center: restaurants[indexNum].position,
					zoom: 18,
					speed: 1.5,
					curve: 1,
					easing(t) {
						return t;
					}
				});

			})
		})

		//Creates ability to recenter the map to the original load instance
		$('#re-center').click(function () {
			map.setZoom(10);
			map.setCenter([
				-96.7969,
				32.7763
			])
		})


	})();
</script>


</body>
</html>