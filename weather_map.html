<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Weather Map</title>
    <!-- Mapbox JS -->

    <script src='https://api.mapbox.com/mapbox-gl-js/v2.7.0/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.7.0/mapbox-gl.css' rel='stylesheet'/>

    <!--Bootstrap CDN-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css"
          integrity="sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn" crossorigin="anonymous">
    <style>
        #map {
            width: 100vw;
            height: 50vh;
        }
    </style>
</head>
<body>
<script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.7.2/mapbox-gl-geocoder.min.js"></script>
<link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.7.2/mapbox-gl-geocoder.css" type="text/css">
<nav class="bg-primary container-fluid">
    <div class="row align-items-baseline justify-content-between">
        <h2 class="py-2 pl-2 text-white">Weather App</h2>
        <p class="pr-2 pt-2 text-white font-weight-bold">Current City: Dallas TX </p>
    </div>
</nav>
<header class="container-fluid">
    <div class="row align-items-baseline">
        <p class="mt-4 ml-4">Place</p>
        <div class="ml-3 geocoder" type="search" id="geocoder"></div>
        <button type="submit" class="btn btn-primary ml-3" id="place-search">Find</button>
    </div>
    <div class="">
        <div class="row align-items-baseline justify-content-center">
            <div class="card mt-4 ml-3 col-10 col-lg-2 px-0" style="width: 18rem;">
                <div class="card-header text-center">
                    Date
                </div>
                <ul class="list-group list-group-flush">
                    <li class="list-group-item text-center">img</li>
                    <li class="list-group-item">
                        <p>Description: <span class="font-weight-bold">Overcast clouds</span></p>
                        <p class="mb-0">Humidity: <span class="font-weight-bold">71%</span></p>
                    </li>
                    <li class="list-group-item">Wind: <span class="font-weight-bold">5.84</span></li>
                    <li class="list-group-item">Pressure: <span class="font-weight-bold">1015</span></li>
                </ul>
            </div>

            <div class="card mt-4 ml-3 col-10 col-lg-2 px-0" style="width: 18rem;">
                <div class="card-header text-center">
                    Date
                </div>
                <ul class="list-group list-group-flush">
                    <li class="list-group-item text-center">img</li>
                    <li class="list-group-item">
                        <p>Description: <span class="font-weight-bold">Overcast clouds</span></p>
                        <p class="mb-0">Humidity: <span class="font-weight-bold">71%</span></p>
                    </li>
                    <li class="list-group-item">Wind: <span class="font-weight-bold">5.84</span></li>
                    <li class="list-group-item">Pressure: <span class="font-weight-bold">1015</span></li>
                </ul>
            </div>

            <div class="card mt-4 ml-3 col-10 col-lg-2 px-0" style="width: 18rem;">
                <div class="card-header text-center">
                    Date
                </div>
                <ul class="list-group list-group-flush">
                    <li class="list-group-item text-center">img</li>
                    <li class="list-group-item">
                        <p>Description: <span class="font-weight-bold">Overcast clouds</span></p>
                        <p class="mb-0">Humidity: <span class="font-weight-bold">71%</span></p>
                    </li>
                    <li class="list-group-item">Wind: <span class="font-weight-bold">5.84</span></li>
                    <li class="list-group-item">Pressure: <span class="font-weight-bold">1015</span></li>
                </ul>
            </div>

            <div class="card mt-4 ml-3 col-10 col-lg-2 px-0" style="width: 18rem;">
                <div class="card-header text-center">
                    Date
                </div>
                <ul class="list-group list-group-flush">
                    <li class="list-group-item text-center">img</li>
                    <li class="list-group-item">
                        <p>Description: <span class="font-weight-bold">Overcast clouds</span></p>
                        <p class="mb-0">Humidity: <span class="font-weight-bold">71%</span></p>
                    </li>
                    <li class="list-group-item">Wind: <span class="font-weight-bold">5.84</span></li>
                    <li class="list-group-item">Pressure: <span class="font-weight-bold">1015</span></li>
                </ul>
            </div>

            <div class="card mt-4 ml-3 col-10 col-lg-2 px-0" style="width: 18rem;">
                <div class="card-header text-center">
                    Date
                </div>
                <ul class="list-group list-group-flush">
                    <li class="list-group-item text-center">img</li>
                    <li class="list-group-item">
                        <p>Description: <span class="font-weight-bold">Overcast clouds</span></p>
                        <p class="mb-0">Humidity: <span class="font-weight-bold">71%</span></p>
                    </li>
                    <li class="list-group-item">Wind: <span class="font-weight-bold">5.84</span></li>
                    <li class="list-group-item">Pressure: <span class="font-weight-bold">1015</span></li>
                </ul>
            </div>
        </div>
        <div class="row">
            <div id='map' class="mt-3 mx-3"></div>
        </div>
    </div>
</header>


<!--Bootstrap CDN-->
<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-fQybjgWLrvvRgtW6bFlB7jaZrFsaBXjsOMm/tB9LTS58ONXgqbR9W8oWht/amnpF"
        crossorigin="anonymous"></script>
<!--CDN Jquery File-->
<script src="https://code.jquery.com/jquery-2.2.4.min.js"
        integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
<script src="js/keys.js"></script>
<script>
	(function () {
		'use strict'
		//Mapbox map created
		mapboxgl.accessToken = KEY_API_MAPBOX;
		let map = new mapboxgl.Map({
			container: 'map',
			style: 'mapbox://styles/mapbox/streets-v11',
			zoom: 10,
			center: [
				-96.7969,
				32.7763
			]
		});

        //Creates map box search box
		const geocoder = new MapboxGeocoder({
			accessToken: mapboxgl.accessToken,
			mapboxgl: mapboxgl
		});
		//Adds map box search to html
		document.getElementById('geocoder').appendChild(geocoder.onAdd(map));

		//Todo: Attempt to get lnglat from map after search to pass to weather api
		map.on('sourcedata', function (e) {
			console.log(e);
		})


		//On submit gets input value from search box and calls sendQueryToOpen weather with input value as a parameter
		function getSearchQuery() {
			$('#place-search').click(function () {
				let inputValue = $('#search-city').val();
				sendQueryToOpenWeather(inputValue);
			});
		}

		getSearchQuery()

		//Sends query to open weather api with value input as param
		function sendQueryToOpenWeather(inputValue) {
			$.get("http://api.openweathermap.org/data/2.5/weather", {
				APPID: OPEN_WEATHER_APPID,
				q: inputValue,
				units: "imperial"
			}).done(function (data) {
				console.log(data)
				flyTo(data)
			});
		}

		//Function to fly to given data coords
		function flyTo(data) {
			map.flyTo({
				center: [data.coord.lon, data.coord.lat],
				zoom: 11,
				speed: 1.5,
				curve: 1,
				easing(t) {
					return t;
				}
			});
		}

		//On click of map point, get coords and send to open weather api for weather info of location clicked on
		function geocodeOnClick() {
			map.on('click', function (e) {
				reverseGeocode(e);
			})
		}

		geocodeOnClick();

		//Todo: Takes lnglat attempt to return city name (not complete)
		function reverseGeocode(e) {
			$.get(`https://api.mapbox.com/geocoding/v5/mapbox.places/${e.lngLat.lng},${e.lngLat.lat}.json?access_token=${KEY_API_MAPBOX}`, {}).done(function (data) {
				console.log(data.features);
			})
		}

		// Todo: Add feature to get weather details after submit from input box

		// Todo: Add feature to get weather details after click on point of map

		//Todo: Add feature that populates cards with weather details 5-day forecast and top right city name

	})();
</script>
</body>
</html>